# ๐ค ุฏุนู ุงููุตูุต ุงูุนุฑุจูุฉ ูู PDF - PrePilot v3

## ุงููุดููุฉ ุงูุฃุตููุฉ:
- ุฎุทุฃ `WinAnsi cannot encode "ุช" (0x062a)` ุนูุฏ ุชุตุฏูุฑ PDF
- `pdf-lib` ูุง ูุฏุนู ุงููุตูุต ุงูุนุฑุจูุฉ ุจุดูู ุงูุชุฑุงุถู

## ุงูุญู ุงููุทุจู:

### 1. **ุฅุถุงูุฉ ููุชุจุฉ fontkit**
```bash
npm install @pdf-lib/fontkit
```

### 2. **ุฏูุฌ ุฎุท ุนุฑุจู ููุงุณุจ**
- ุงุณุชุฎุฏุงู ุฎุท **Noto Sans Arabic** ูู Google Fonts
- ุงูุฎุท ูุฏุนู ุฌููุน ุงูุฃุญุฑู ุงูุนุฑุจูุฉ ูุงููุงุชูููุฉ
- ุฌูุฏุฉ ุนุงููุฉ ูููุงุณุจ ููุนุฑุถ ุงูุงุญุชุฑุงูู
- ูุญุณู ุฎุตูุตุงู ูู `pdf-lib/fontkit`

### 3. **ุชุญุฏูุซ PDF Exporter**

#### **ุฏุงูุฉ ุชุญููู ุงูุฎุท ุงูุนุฑุจู:**
```typescript
async function loadArabicFont(pdfDoc: PDFDocument) {
  try {
    pdfDoc.registerFontkit(fontkit);
    const response = await fetch('/NotoSansArabic-Regular.ttf');
    if (response.ok) {
      const fontBytes = await response.arrayBuffer();
      return await pdfDoc.embedFont(fontBytes);
    }
  } catch (error) {
    console.warn('Could not load Noto Sans Arabic font, falling back to Helvetica:', error);
  }
  return await pdfDoc.embedFont(StandardFonts.Helvetica);
}

// ุฏุงูุฉ ุชุญููู ุงูุฎุท ุงูุนุฑูุถ
async function loadArabicBoldFont(pdfDoc: PDFDocument) {
  try {
    pdfDoc.registerFontkit(fontkit);
    const response = await fetch('/NotoSansArabic-Bold.ttf');
    if (response.ok) {
      const fontBytes = await response.arrayBuffer();
      return await pdfDoc.embedFont(fontBytes);
    }
  } catch (error) {
    console.warn('Could not load Noto Sans Arabic Bold font, falling back to Helvetica Bold:', error);
  }
  return await pdfDoc.embedFont(StandardFonts.HelveticaBold);
}
```

#### **ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุฑุจู:**
```typescript
// ุชุญููู ุงูุฎุทูุท ุงูุนุฑุจูุฉ
const arabicFont = await loadArabicFont(pdfDoc);
const arabicBoldFont = await loadArabicBoldFont(pdfDoc);

// ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุฑูุถ ููุนูุงููู
page.drawText('PrePilot - ุชูุฑูุฑ ุงูุญููุฉ ุงูุฅุนูุงููุฉ', {
  x: margin,
  y: yPosition,
  size: 20,
  font: arabicBoldFont, // ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุฑูุถ
  color: rgb(0.2, 0.2, 0.2),
});

// ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุงุฏู ูููุตูุต
page.drawText('ุงูุตูุงุนุฉ: ุชุฌุงุฑุฉ ุฅููุชุฑูููุฉ', {
  x: margin,
  y: yPosition,
  size: 12,
  font: arabicFont, // ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุงุฏู
  color: rgb(0.4, 0.4, 0.4),
});
```

### 4. **ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:**

#### **โ ุฏุนู ูุงูู ูููุตูุต ุงูุนุฑุจูุฉ:**
- ุนูุงููู ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- ุจูุงูุงุช ุงูุชูุฑูุฑ ุจุงูุนุฑุจูุฉ
- ุชูุตูู ุงูููุตุงุช ุจุงูุนุฑุจูุฉ
- ุชุฐููู ุงูุตูุญุฉ ุจุงูุนุฑุจูุฉ

#### **โ ุชูุณูู ูุญุณู:**
- ุงุณุชุฎุฏุงู `toLocaleString('ar-SA')` ููุฃุฑูุงู
- ุชูุณูู ุงูุชูุงุฑูุฎ ุจุงูุนุฑุจูุฉ
- ุชุฑุชูุจ ุงููุตูุต ูู ุงููููู ูููุณุงุฑ

#### **โ Fallback ุฐูู:**
- ุฅุฐุง ูุดู ุชุญููู ุงูุฎุท ุงูุนุฑุจู โ ุงุณุชุฎุฏุงู Helvetica
- ุฑุณุงุฆู ุชุญุฐูุฑ ูู console
- ูุง ูุชููู ุงูุชุทุจูู ุนูุฏ ูุดู ุชุญููู ุงูุฎุท

### 5. **ุงููููุงุช ุงููุญุฏุซุฉ:**

#### **`services/export/pdfExporter.ts`:**
- ุฅุถุงูุฉ `@pdf-lib/fontkit`
- ุฏุงูุฉ `loadArabicFont()`
- ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุฑุจู ูู ุฌููุน ุงููุตูุต
- ุชุญุณูู ุชูุณูู ุงูุฃุฑูุงู ูุงูุชูุงุฑูุฎ

#### **`public/NotoSansArabic-Regular.ttf` ู `NotoSansArabic-Bold.ttf`:**
- ุฎุทูุท ุนุฑุจูุฉ ุนุงููุฉ ุงูุฌูุฏุฉ ูู Google Fonts
- ูุฏุนู ุฌููุน ุงูุฃุญุฑู ุงูุนุฑุจูุฉ ูุงููุงุชูููุฉ
- ูุญุณู ุฎุตูุตุงู ูู `pdf-lib/fontkit`
- ูุชูุงูู ูุน ุฌููุน ุฃูุธูุฉ ุงูุชุดุบูู

### 6. **ููููุฉ ุงูุนูู:**

#### **ุนูุฏ ุชุตุฏูุฑ PDF:**
1. **ุชุญููู ุงูุฎุทูุท ุงูุนุฑุจูุฉ** ูู `/public/NotoSansArabic-Regular.ttf` ู `NotoSansArabic-Bold.ttf`
2. **ุชุณุฌูู fontkit** ูู PDF document
3. **ุฏูุฌ ุงูุฎุทูุท** ูู PDF
4. **ุงุณุชุฎุฏุงู ุงูุฎุท ุงูุนุฑูุถ** ููุนูุงููู ูุงูุฎุท ุงูุนุงุฏู ูููุตูุต
5. **ุฅูุดุงุก PDF** ูุน ุฏุนู ูุงูู ููุนุฑุจูุฉ

#### **ุนูุฏ ูุดู ุชุญููู ุงูุฎุท:**
1. **ุชุญุฐูุฑ ูู console**
2. **ุงุณุชุฎุฏุงู Helvetica** ูุจุฏูู
3. **ูุชุงุจุนุฉ ุงูุนูู** ุจุฏูู ุชููู

### 7. **ุงููุชูุฌุฉ:**

#### **โ ูุจู ุงูุฅุตูุงุญ:**
- ุฎุทุฃ `WinAnsi cannot encode`
- ูุตูุต ุบูุฑ ููุฑูุกุฉ
- ุชููู ุงูุชุตุฏูุฑ

#### **โ ุจุนุฏ ุงูุฅุตูุงุญ:**
- ุฏุนู ูุงูู ูููุตูุต ุงูุนุฑุจูุฉ
- ุนุฑุถ ุตุญูุญ ููุฃุญุฑู
- ุชูุณูู ุงุญุชุฑุงูู
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ

### 8. **ุงุฎุชุจุงุฑ ุงููุธููุฉ:**

1. **ุฃูุดุฆ ุชูุฑูุฑ ุฌุฏูุฏ**
2. **ุงูุชูู ุฅูู ุตูุญุฉ ุงููุชุงุฆุฌ**
3. **ุงุถุบุท ุนูู ุฒุฑ PDF** ูู ุฃู ูุณู
4. **ุชุญูู ูู ุงูููู ุงููุญูู** - ูุฌุจ ุฃู ุชุธูุฑ ุงููุตูุต ุงูุนุฑุจูุฉ ุจูุถูุญ

---

## ๐ **ุงูุขู PDF ูุฏุนู ุงููุตูุต ุงูุนุฑุจูุฉ ุจุดูู ูุงูู!**

### **ุงููููุฒุงุช:**
- โ ูุตูุต ุนุฑุจูุฉ ูุงุถุญุฉ ูููุฑูุกุฉ
- โ ุชูุณูู ุงุญุชุฑุงูู
- โ ุฏุนู ุงูุฃุฑูุงู ูุงูุชูุงุฑูุฎ ุงูุนุฑุจูุฉ
- โ Fallback ุฐูู ุนูุฏ ูุดู ุชุญููู ุงูุฎุท
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ

**ุฌุฑุจ ุชุตุฏูุฑ PDF ุงูุขู - ุณุชุญุตู ุนูู ูููุงุช ุงุญุชุฑุงููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ! ๐**
